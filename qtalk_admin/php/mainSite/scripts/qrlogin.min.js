function QRLogin(){var a=QRLogin.LoginState.QRCode;var h="";var e=500;var j;var d=10;var g=0;var c;this.startQRLogin=function(k){j=k;$.ajax({type:"GET",dataType:"json",url:"./qrlogin_method_ajax.php?action=qrimg",timeout:1000,success:function(l){if(l.ok){c=l.msg;j.call(this,a,c);a=QRLogin.LoginState.Init;h=l.key;i()}}})};this.stopQRLogin=function(){$.ajax({type:"GET",url:"./qrlogin_method_ajax.php?action=cancel&key="+h})};function b(){$.ajax({type:"GET",url:"./qrlogin_method_ajax.php?action=init&key="+h,dataType:"json",timeout:1000,success:function(k){if(k.ok){a=QRLogin.LoginState.Waiting_Scan;e=k.msg*1000;if(e<=0){e=500}j.call(this,a,k.msg);setTimeout(i(),e)}else{setTimeout(i(),500);g++}}})}function f(k){$.ajax({type:"GET",url:"./qrlogin_method_ajax.php?action=check_ready&phase="+k+"&key="+h,dataType:"json",timeout:1000,success:function(m){if(m.ok){var l=JSON.parse(m.msg);switch(parseInt(l.t)){case 1:if(k==1){a=QRLogin.LoginState.Waiting_Confirm;j.call(this,a,l)}else{a=QRLogin.LoginState.Auth;j.call(this,a,l)}i();break;case 2:a=QRLogin.LoginState.TimeOut;i();break;case 3:setTimeout(i(),e);break;case 4:a=QRLogin.LoginState.Cancel;i();break;default:setTimeout(i(),e);break}}else{setTimeout(i(),e);g++}}})}function i(){if(g>d){a=QRLogin.LoginState.Faild;j.call(this,a,"失败");return}switch(a){case QRLogin.LoginState.Init:b();break;case QRLogin.LoginState.Waiting_Scan:f(1);break;case QRLogin.LoginState.Waiting_Confirm:f(2);break;case QRLogin.LoginState.Auth:break;case QRLogin.LoginState.Cancel:j.call(this,QRLogin.LoginState.QRCode,c);break;case QRLogin.LoginState.TimeOut:j(this,a,"超时");break}}}QRLogin.LoginState={"QRCode":0,"Init":1,"Waiting_Scan":2,"Waiting_Confirm":3,"Auth":4,"Cancel":5,"TimeOut":6,"Faild":7};